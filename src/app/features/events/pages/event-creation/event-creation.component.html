<div *ngIf="error" class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
    <p class="text-red-800">{{ error }}</p>
</div>

<form [formGroup]="eventForm" (ngSubmit)="onSubmit()"
    class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 space-y-6">
    <!-- Title -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Event Title *</label>
        <input type="text" formControlName="title"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            placeholder="Enter event title" />
        <p *ngIf="f['title'].touched && f['title'].errors?.['required']" class="mt-1 text-sm text-red-600">
            Title is required (Debug: Required Error)
        </p>
    </div>

    <!-- Description -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
        <textarea formControlName="description" rows="4"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            placeholder="Describe your event"></textarea>
        <p *ngIf="f['description'].touched && f['description'].errors?.['required']" class="mt-1 text-sm text-red-600">
            Description is required
        </p>
    </div>

    <!-- Date and Time -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Date *</label>
            <input type="date" formControlName="date"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500" />
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Start Time *</label>
            <input type="time" formControlName="time"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500" />
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
            <input type="time" formControlName="end_time"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500" />
        </div>
    </div>

    <!-- Location -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Location *</label>
        <input type="text" formControlName="location"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            placeholder="Event location or venue" />
    </div>

    <!-- Category and Max Participants -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
            <select formControlName="category"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                <option value="">Select category</option>
                <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Max Participants</label>
            <input type="number" formControlName="max_participants"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
                placeholder="Leave empty for unlimited" />
        </div>
    </div>

    <!-- Virtual Event -->
    <div class="flex items-center">
        <input type="checkbox" formControlName="is_virtual" id="is_virtual"
            class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded" />
        <label for="is_virtual" class="ml-2 block text-sm text-gray-700">
            This is a virtual event
        </label>
    </div>

    <!-- Virtual Link (shown only if virtual) -->
    <div *ngIf="eventForm.get('is_virtual')?.value">
        <label class="block text-sm font-medium text-gray-700 mb-2">Virtual Meeting Link</label>
        <input type="url" formControlName="virtual_link"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            placeholder="https://meet.google.com/..." />
    </div>

    <!-- Image Upload -->
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Event Image (optional)</label>

        <div class="flex flex-col gap-4">
            <div *ngIf="imagePreview"
                class="relative w-full max-w-sm h-48 rounded-lg overflow-hidden border border-gray-200 bg-gray-50">
                <img [src]="imagePreview" class="w-full h-full object-contain">
                <button type="button"
                    (click)="selectedFile = null; imagePreview = null; eventForm.get('image_url')?.setValue('')"
                    class="absolute top-2 right-2 bg-red-600 text-white p-1 rounded-full hover:bg-red-700 transition-colors shadow-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="flex items-center justify-center w-full" *ngIf="!imagePreview">
                <label for="dropzone-file"
                    class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                            fill="none" viewBox="0 0 20 16">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2" />
                        </svg>
                        <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag
                            and drop</p>
                        <p class="text-xs text-gray-500">SVG, PNG, JPG or GIF (MAX. 5MB)</p>
                    </div>
                    <input id="dropzone-file" type="file" class="hidden" (change)="onFileSelected($event)"
                        accept="image/*" />
                </label>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex items-center gap-4 pt-4 border-t border-gray-200">
        <button type="submit" [disabled]="loading" class="action-btn primary">
            <span *ngIf="!loading">Create Event</span>
            <span *ngIf="loading">Creating...</span>
        </button>
        <button type="button" (click)="cancel()" [disabled]="loading" class="action-btn secondary">
            Cancel
        </button>
    </div>
</form>